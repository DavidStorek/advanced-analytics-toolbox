"use strict";define(["../chart/line_chart","../chart/datatables","../util/utils","ng!$q","../../vendor/d3-format.min"],function(e,r,t,o,a){return{createCube:function(e,r){var o=r.layout,a=t.validateDimension(o.props.dimensions[0]),s=[{qNullSuppression:!0,qDef:{qFieldDefs:[a],qSortCriterias:[{qSortByExpression:o.props.dimSort||!o.props.dimSortByExpression?0:o.props.dimSortByExpressionAsc,qSortByNumeric:o.props.dimSort?1:o.props.dimSortByNum?o.props.dimSortByNumAsc:0,qSortByAscii:o.props.dimSort||!o.props.dimSortByAlph?0:o.props.dimSortByAlphAsc,qExpression:{qv:o.props.dimSortByExpressionString}}]}}],p=t.validateMeasure(o.props.measures[0]),i='json<-toJSON(list(res[,1], res[,2], res[,3], coef(summary(lm_result))[,"Estimate"]));';o.props.extendLine&&(i="by<-q$Dimension[length(q$Dimension)]-q$Dimension[length(q$Dimension)-1]; from<-q$Dimension[length(q$Dimension)]+by;\n                    data<-seq(from=from, by=by, length.out="+o.props.extendDurations+'); newdata <-data.frame(Dimension=data); pred_res<-predict(lm_result,newdata, interval="'+o.props.interval+'", level='+o.props.confidenceLevel+');\n                    json<-toJSON(list(res[,1], res[,2], res[,3], coef(summary(lm_result))[,"Estimate"], pred_res[,1], pred_res[,2], pred_res[,3]));'),t.displayDebugModeMessage(o.props.debugMode);var n=t.getDebugSaveDatasetScript(o.props.debugMode,"debug_simple_linear_line.rda"),l="R.ScriptEvalExStr('NN','"+n+' library(jsonlite); lm_result <- lm(Measure~Dimension, data=q);res<-predict(lm_result, interval="'+o.props.interval+'", level='+o.props.confidenceLevel+");\n      "+i+" json;',"+a+" as Dimension, "+p+" as Measure)";t.displayRScriptsToConsole(o.props.debugMode,[l]);var d=[{qDef:{qDef:p}},{qDef:{qLabel:"Fit",qDef:l}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}},{qDef:{qLabel:"-",qDef:""}}];return r.backendApi.applyPatches([{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(s)},{qPath:"/qHyperCubeDef/qMeasures",qOp:"replace",qValue:JSON.stringify(d)}],!1),r.patchApplied=!0,null},drawChart:function(a,s){var p=o.defer(),i=a.layout,n=[{qTop:0,qLeft:0,qWidth:6,qHeight:1500}];return a.backendApi.getData(n).then(function(o){a.layout.qHyperCube.qMeasureInfo;if(0===o[0].qMatrix[0][1].qText.length||"-"==o[0].qMatrix[0][1].qText)t.displayConnectionError(a.extId);else{t.displayReturnedDatasetToConsole(i.props.debugMode,o[0]);var n=t.getDefaultPaletteColor(),l=JSON.parse(o[0].qMatrix[0][2].qText),d=l[0],m=l[1],u=l[2],c=l[3],q=l[4],f=l[5],h=l[6],y=i.props.limit,b="y="+c[1]+"x";if(b+=c[0]<0?""+c[0]:"+"+c[0],"undefined"==typeof a.layout.props.displayTable||0==a.layout.props.displayTable){var x=[],g=[],v=[],D=[];if($.each(o[0].qMatrix,function(e,r){x.push(r[0].qElemNumber),g.push(r[0].qText),v.push(r[1].qNum),D.push(y)}),i.props.extendLine){$.merge(d,q),$.merge(m,f),$.merge(u,h);for(var S=0;S<i.props.extendDurations;S++)g.push("+"+(S+1)),v.push(""),D.push(y)}var M=[{x:g,y:v,elemNum:x,name:"Observed",mode:"lines+markers",fill:i.props.line,fillcolor:i.props.colors?"rgba("+n[3]+",0.3)":"rgba("+n[i.props.colorForMain]+",0.3)",marker:{color:i.props.colors?"rgba("+n[3]+",1)":"rgba("+n[i.props.colorForMain]+",1)",size:i.props.datapoints?i.props.pointRadius:1},line:{width:i.props.borderWidth}},{x:g,y:d,name:"Fit",line:{color:"rgba("+n[i.props.colorForSub]+",1)"}},{x:g,y:m,name:"Lower",fill:"tonexty",fillcolor:"rgba("+n[i.props.colorForSub]+",0.3)",type:"scatter",mode:"none"},{x:g,y:u,name:"Upper",fill:"tonexty",fillcolor:"rgba("+n[i.props.colorForSub]+",0.3)",type:"scatter",mode:"none"},{x:g,y:D,name:i.props.limitlabel,mode:"lines",marker:{color:"rgba("+n[i.props.limitcolor]+",1)",size:i.props.datapoints?i.props.pointRadius:1},line:{dash:i.props.limitstyle,width:i.props.limitwidth}}],N=Math.floor(g.length/2),B=g[N],E=d[N],w={annotations:[]};i.props.displayFormula&&w.annotations.push({x:B,y:E,text:b,xref:"x",yref:"y",ax:-30,ay:-40,showarrow:!0,arrowhead:3}),$(".advanced-analytics-toolsets-"+a.extId).html('<div id="aat-chart-'+a.extId+'" style="width:100%;height:100%;"></div>');var L=e.draw(a,M,"aat-chart-"+a.extId,w);e.setEvents(L,a,s)}else{var _=t.getLocale(a,0),F=t.getNumberFormat(a,0),C=[];if($.each(o[0].qMatrix,function(e,r){C.push([r[0].qElemNumber,r[0].qText,_.format(F)(r[1].qNum).replace(/G/,"B"),_.format(F)(d[e]).replace(/G/,"B"),_.format(F)(m[e]).replace(/G/,"B"),_.format(F)(u[e]).replace(/G/,"B")])}),i.props.extendLine)for(var T=0;T<i.props.forecastingPeriods;T++)C.push(["","+"+(T+1),"",_.format(F)(q[T]).replace(/G/,"B"),_.format(F)(f[T]).replace(/G/,"B"),_.format(F)(h[T]).replace(/G/,"B")]);var A='\n              <table id="aat-table-'+a.extId+'" class="display">\n                <thead>\n                  <tr>\n                    <th>qElemNumber</th>\n                    <th>'+a.layout.props.dimensions[0].label+"</th>\n                    <th>"+a.layout.props.measures[0].label+"</th>\n                    <th>Fit</th>\n                    <th>Lower</th>\n                    <th>Upper</th>\n                  </tr>\n                </thead>\n                <tbody>\n                </tbody>\n              </table>";r.draw(s,a,"#aat-table-"+a.extId,C,A,null).then(function(e){r.setEvents(e,a,s)})}}return p.resolve()}),p.promise}}});
//# sourceMappingURL=../../maps/analysis/simple_linear_line.js.map
